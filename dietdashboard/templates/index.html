<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Nutrition Dashboard</title>
    <script
      data-goatcounter="https://sorbro.goatcounter.com/count"
      async
      src="//gc.zgo.at/count.js"
    ></script>
    <script type="module" src="static/bundle.js"></script>
    <link rel="stylesheet" href="static/bundle.css" />
  </head>

  <body>
    <header>
      <h1>Nutrition Dashboard</h1>
      <div class="selectors">
        <details>
          <summary>Select Nutrients</summary>
          <ul>
            {% for nutrient_group in nutrient_groups %}
            <li class="nutrient-group">
              <div class="nutrient-group-header">
                <strong>{{ nutrient_group.name }}</strong>
                <div class="nutrient-group-actions">
                  <button
                    class="select-all-btn"
                    data-category="{{ nutrient_group.id }}"
                  >
                    Select All
                  </button>
                  <button
                    class="deselect-all-btn"
                    data-category="{{ nutrient_group.id }}"
                  >
                    Deselect All
                  </button>
                </div>
              </div>
              <ul class="nutrient-list" data-category="{{ nutrient_group.id }}">
                {% for nutrient in nutrient_group.nutrients %}
                <li>
                  <label>
                    <input
                      type="checkbox"
                      class="nutrient-checkbox"
                      value="{{ nutrient.id }}"
                      id="nutrient-checkbox-{{ nutrient.id }}"
                      data-category="{{ nutrient_group.id }}"
                      checked
                    />
                    {{ nutrient.name }}
                  </label>
                </li>
                {% endfor %}
              </ul>
            </li>
            {% endfor %}
          </ul>
        </details>

        <select id="currency" data-optimization="currency">
          {% for currency in currencies %}
          <option value="{{ currency }}">{{ currency }}</option>
          {% endfor %}
        </select>
      </div>
    </header>

    <div class="dashboard-content">
      <div class="dashboard-column">
        <h2>Nutrient Targets</h2>
        <p style="margin: 0 0 0.5rem; font-size: 0.85rem">
          Adjust your nutrient targets to optimize your diet.
        </p>
        <table style="border-spacing: 0">
          <colgroup>
            <col style="width: 15%" />
            <col style="width: 85%" />
          </colgroup>
          <tbody>
            {% for slider in sliders %}
            <tr
              id="slider-row-{{ slider.id }}"
              style="vertical-align: middle; line-height: 1.2"
            >
              <td
                style="padding: 0 0 0 0; font-size: 0.85rem; text-align: center"
              >
                <div class="nutrient-name-container">
                  <span>{{ slider.name }} ({{ slider.unit }})</span>
                  <button
                    class="range-edit-btn"
                    data-slider-id="{{ slider.id }}"
                    data-slider-name="{{ slider.name }}"
                    data-slider-unit="{{ slider.unit }}"
                  >
                    Edit Range
                  </button>
                </div>
              </td>
              <td style="padding: 0 0 0 0">
                <div
                  id="{{ slider.id }}"
                  class="slider-container"
                  data-min="{{ slider.min }}"
                  data-lower="{{ slider.lower }}"
                  data-max="{{ slider.max }}"
                  data-upper="{{ slider.upper }}"
                  data-optimization="slider"
                ></div>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <div class="dashboard-column">
        <h2>Optimized Meal</h2>
        <p>
          The recommended food items and quantities to meet your nutrient
          targets.
        </p>
        <div id="result"></div>
      </div>
    </div>

    <!-- Modal for editing slider ranges -->
    <div id="rangeModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modalTitle">Edit Range</h3>
          <span class="close-modal">&times;</span>
        </div>
        <form id="rangeForm" class="modal-form">
          <input type="hidden" id="currentSliderId" />
          <div class="form-group">
            <label for="minValue">Minimum Value:</label>
            <input type="number" id="minValue" min="0" step="1" required />
          </div>
          <div class="form-group">
            <label for="maxValue">Maximum Value:</label>
            <input type="number" id="maxValue" min="0" step="1" required />
          </div>
          <div class="modal-buttons">
            <button type="button" class="modal-btn cancel-btn" id="cancelBtn">
              Cancel
            </button>
            <button type="submit" class="modal-btn save-btn">
              Save Changes
            </button>
          </div>
        </form>
      </div>
    </div>
  </body>
</html>
